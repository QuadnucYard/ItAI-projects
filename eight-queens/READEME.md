# 八皇后问题

用 OOP 写的最小冲突法求解器，理论上适用于各种问题。

## 关键技术

该算法需要解决一个技术问题：如何快速求冲突？

冲突相关的函数有：

1. 找到有冲突的项（实验证明找冲突最大的是更优的）
2. 找到一个使冲突最小的调整方案（由于冲突关系具有对称性，事实上只要求待调整变量在每个赋值下的冲突数）。

八皇后算法一般使用 3 个数组来记录列、主对角线、副对角线是否有冲突（假定行不冲突是自然满足的），这种策略在此也是可行的，只不过维护的是冲突数。总共的冲突数为 3 个数组元素之和，当然还需要减去自身冲突项。

## Benchmark

下标展示了某随机种子下，不同步数限制的失败次数（$s$ 表示步数限制）。

| size | s=50 | s=100 | s=150 | s=200 | s=250 | s=300 | s=350 | s=400 | s=450 | s=500 |
| :--: | :--: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  4   |  2   |   0   |   0   |   0   |   0   |   0   |   0   |   0   |   0   |   0   |
|  8   | 337  |  182  |  123  |  97   |  101  |  100  |  92   |  95   |  80   |  88   |
|  12  | 558  |  332  |  214  |  162  |  130  |  100  |  101  |  103  |  82   |  59   |
|  16  | 597  |  257  |  113  |  77   |  41   |  39   |  25   |  39   |  23   |  41   |
|  20  | 679  |  251  |  72   |  36   |  18   |  18   |  17   |  14   |  14   |  21   |
|  24  | 783  |  237  |  80   |  25   |  22   |   8   |   8   |   5   |  12   |   7   |
|  28  | 881  |  290  |  64   |  19   |  11   |   4   |   8   |   4   |   5   |   2   |
|  32  | 938  |  328  |  90   |  24   |   7   |   4   |   0   |   1   |   4   |   4   |
|  36  | 982  |  362  |  86   |  22   |   8   |   1   |   3   |   5   |   2   |   3   |
|  40  | 1000 |  405  |  89   |  21   |   5   |   0   |   0   |   0   |   2   |   0   |
|  44  | 1000 |  469  |  107  |  19   |   4   |   2   |   0   |   1   |   1   |   1   |
|  48  | 1000 |  561  |  108  |  24   |   3   |   1   |   1   |   0   |   0   |   1   |
|  52  | 1000 |  664  |  143  |  20   |   8   |   2   |   1   |   0   |   0   |   0   |
|  56  | 1000 |  715  |  158  |  42   |   5   |   1   |   0   |   1   |   0   |   0   |
|  60  | 1000 |  814  |  192  |  29   |   7   |   2   |   0   |   0   |   0   |   0   |
|  64  | 1000 |  883  |  238  |  37   |  10   |   1   |   1   |   0   |   0   |   0   |

$n=10000$ 时，可以在 3.8s 内使用 10123 步给出解答（O3 优化）。

## 一些不足

1. `Queen` 继承了 `Variable` 类，但是它仅仅加了一个棋盘大小，这个值存在这里不太合适，因为它由所有变量共享。这个 `n` 仅用于 `domain` 函数。一个比较合适的方法是在 `CSP` 类中实现 `domain`，但这要求 `CSPQueens` 重写该函数，而它的返回值是个 `view`，虚函数不合适做这个，故放弃。
2. 搜索使用的 `Assignment` 是模板类，没有加成员函数约束。
3. 随机函数有点重要。如果不给 `mt19937` 随机种子，那么 6 皇后问题无法求解。
4. 能否合并 `Assignment` 和 `CSP` 类？
